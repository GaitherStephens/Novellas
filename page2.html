<!--Novellas by SPQRGuyMontag
Based on Metro-UI-CSS by Sergey Pimenov
Built on the work of JunesiPhone and Matchstic-->
<!DOCTYPE html>
<html>
  <head>
    <title>Novellas by SPQRGuyMontag</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link href="css/main.css" rel="stylesheet">
    <script src="js/lang.js"></script>
    <script src="js/swipes.js"></script>
    <script src="js/main.js"></script>
  </head>
  <body style="overflow-y: hidden;">
    <div id="mainElement">
      <div id="statusBar"></div>

      <div id="tile18Container">
        <img id="tile18Icon">
        <div id="tile18Count"></div>
      </div>

      <div id="tile19Container">
        <img id="tile19Icon">
        <div id="tile19Count"></div>
      </div>

      <div id="tile20Container">
        <img id="tile20Icon">
        <div id="tile20Count"></div>
      </div>

      <div id="tile21Container">
        <!-- start sw-rss-feed code -->
        <script type="text/javascript">
        <!--
        rssfeed_url = new Array();
        rssfeed_url[0]="http://news.yahoo.com/rss/"; rssfeed_url[1]="https://www.engadget.com/tag/rss/"; rssfeed_url[2]="http://feeds.gawker.com/gizmodo/full"; rssfeed_url[3]="http://feeds.gawker.com/lifehacker/full";
        rssfeed_frame_width="250";
        rssfeed_frame_height="220";
        rssfeed_scroll="on";
        rssfeed_scroll_step="5";
        rssfeed_scroll_bar="off";
        rssfeed_target="_blank";
        rssfeed_font_size="14";
        rssfeed_font_face="Segoe UI";
        rssfeed_border="off";
        rssfeed_css_url="";
        rssfeed_title="off";
        rssfeed_title_name="";
        rssfeed_title_bgcolor="";
        rssfeed_title_color="#fff";
        rssfeed_title_bgimage="http://";
        rssfeed_footer="off";
        rssfeed_footer_name="rss feed";
        rssfeed_footer_bgcolor="";
        rssfeed_footer_color="#fff";
        rssfeed_footer_bgimage="";
        rssfeed_item_title_length="70";
        rssfeed_item_title_color="#fff";
        rssfeed_item_bgcolor="";
        rssfeed_item_bgimage="http://";
        rssfeed_item_border_bottom="off";
        rssfeed_item_source_icon="off";
        rssfeed_item_date="off";
        rssfeed_item_description="on";
        rssfeed_item_description_length="120";
        rssfeed_item_description_color="#fff";
        rssfeed_item_description_link_color="#fff";
        rssfeed_item_description_tag="on";
        rssfeed_no_items="0";
        rssfeed_cache = "c8659b438668c6c51ead5ebb6d2f9d45";
        //-->
        </script>
        <script type="text/javascript" src="http://feed.surfing-waves.com/js/rss-feed.js"></script>
        <!-- The link below helps keep this service FREE, and helps other people find the SW widget. Please be cool and keep it! Thanks. -->
        <div style="text-align:right; width:240px;"><a href="http://www.surfing-waves.com/feed.htm" target="_blank" style="color:#fff;font-size:8px">widget @</a> <a href="http://www.surfing-waves.com" target="_blank" style="color:#fff;font-size:8px">surfing-waves.com</a></div>
        <!-- end sw-rss-feed code -->
      </div>

      <div id="tile22Container">
        <img id="tile22Icon">
        <div id="tile22Count"></div>
      </div>

      <div id="tile23Container">
        <img id="tile23Icon">
        <div id="tile23Count"></div>
      </div>

      <div id="tile24Container">
          <div id="eventscontainer">

            <div style="padding:5px;"></div>

              <div id="eventOne" class="event">
                <p id="eventOneColour" class="colour"></p>
                <p id="eventOneTitle" class="title"></p>
                <p id="eventOneTime" class="time"></p>
              </div>

              <div id="eventTwo" class="event">
                <p id="eventTwoColour" class="colour"></p>
                <p id="eventTwoTitle" class="title"></p>
                <p id="eventTwoTime" class="time"></p>
              </div>

              <div id="eventThree" class="event">
                <p id="eventThreeColour" class="colour"></p>
                <p id="eventThreeTitle" class="title"></p>
                <p id="eventThreeTime" class="time"></p>
              </div>

              <div id="eventFour" class="event">
                <p id="eventFourColour" class="colour"></p>
                <p id="eventFourTitle" class="title"></p>
                <p id="eventFourTime" class="time"></p>
              </div>

              <div id="eventFive" class="event">
                <p id="eventFiveColour" class="colour"></p>
                <p id="eventFiveTitle" class="title"></p>
                <p id="eventFiveTime" class="time"></p>
              </div>

              <div id="noevents">
               <center><p>No Events</p></center>
              </div>
            </div>
          </div>

          <div id="tile25Container">
            <img id="tile25Icon">
            <div id="tile25Count"></div>
          </div>

          <div id="tile26Container">
            <img id="tile26Icon">
            <div id="tile26Count"></div>
          </div>

          <div id="tile27Container">
            <img id="tile27Icon" src="images/tiles/appstore.svg">
          </div>

          <div id="tile28Container">
            <img id="tile28Icon" src="images/tiles/cydia.svg">
          </div>

          <div id="tile29Container">
            <img id="tile29Icon" src="images/tiles/calendar.svg">
          </div>

          <div id="tile30Container">
            <img id="tile30Icon" src="images/tiles/reminders.svg">
          </div>

          <div id="tile31Container">
            <img id="tile31Icon" src="images/tiles/findmyiphone.svg">
          </div>

          <div id="tile32Container">
            <img id="tile32Icon" src="images/tiles/chevron-left.svg">
          </div>
        </div>

    <script type="text/cycript">
      //<![CDATA[
      var widgetIdentifier = "com.gaitherstephens.novellas";
      var tile18 = tile18Op;
      var tile19 = tile19Op;
      var tile20 = tile20Op;
      var tile22 = tile22Op;
      var tile23 = tile23Op;
      var tile25 = tile25Op;
      var tile26 = tile26Op;
      var twentyfourhour = twentyfourhourOp;
      var bgColor = bgColorOp;
      var bgOpacity = bgOpacityOp;
      var tilesOpacity = tilesOpacityOp;
      var tilesColor = tilesColorOp;
      // Setup of widget
      window.onload = function() {
        // Code to run after calendar data updates.
        [IS2Calendar registerForCalendarNotificationsWithIdentifier:widgetIdentifier andCallback:^ void () {
          // Update onscreen elements
          updateCalendarData();
        }];
        updateCalendarData();
        [IS2Notifications registerForBulletinNotificationsWithIdentifier:widgetIdentifier andCallback:^ void () {
            updateNotifications();
        }];
        updateNotifications();
      }

      // Make sure to de-register ourselves when removed from the user's screen.
      window.onunload = function() {
        [IS2Notifications unregisterForNotificationsWithIdentifier:widgetIdentifier];
        return null;
      };

        document.getElementById("mainElement").style.backgroundColor = "rgba("+bgColor+bgOpacity+")";


      if(tilesColor === "multicolor"){
        document.getElementById("tile18Container").style.backgroundColor = getAppColor(tile18)+tilesOpacity+")";
        document.getElementById("tile19Container").style.backgroundColor = getAppColor(tile19)+tilesOpacity+")";
        document.getElementById("tile20Container").style.backgroundColor = getAppColor(tile20)+tilesOpacity+")";
        document.getElementById("tile21Container").style.backgroundColor = "rgba(255,255,255,"+tilesOpacity+")";
        document.getElementById("tile22Container").style.backgroundColor = getAppColor(tile22)+tilesOpacity+")";
        document.getElementById("tile23Container").style.backgroundColor = getAppColor(tile23)+tilesOpacity+")";
        document.getElementById("tile24Container").style.backgroundColor = getAppColor(tile25)+tilesOpacity+")";
        document.getElementById("tile25Container").style.backgroundColor = "rgba(173,16,60,"+tilesOpacity+")";
        document.getElementById("tile26Container").style.backgroundColor = getAppColor(tile26)+tilesOpacity+")";
        document.getElementById("tile27Container").style.backgroundColor = "rgba(254,124,34,"+tilesOpacity+")";
        document.getElementById("tile28Container").style.backgroundColor = "rgba(0,193,63,"+tilesOpacity+")";
        document.getElementById("tile29Container").style.backgroundColor = "rgba(255,29,119,"+tilesOpacity+")";
        document.getElementById("tile30Container").style.backgroundColor = "rgba(225,183,0,"+tilesOpacity+")";
        document.getElementById("tile31Container").style.backgroundColor = "rgba(0,130,135,"+tilesOpacity+")";
        document.getElementById("tile32Container").style.backgroundColor = "rgba(99,47,0,"+tilesOpacity+")";
      }else{
        for(i = 18; i < 33; i++){
          document.getElementById("tile"+i+"Container").style.backgroundColor = "rgba("+tilesColor+tilesOpacity+")";
        }
      }

      document.getElementById("tile18Icon").src = "images/tiles/" + tile18 + ".svg";
      document.getElementById("tile19Icon").src = "images/tiles/" + tile19 + ".svg";
      document.getElementById("tile20Icon").src = "images/tiles/" + tile20 + ".svg";
      document.getElementById("tile22Icon").src = "images/tiles/" + tile22 + ".svg";
      document.getElementById("tile23Icon").src = "images/tiles/" + tile23 + ".svg";
      document.getElementById("tile25Icon").src = "images/tiles/" + tile25 + ".svg";
      document.getElementById("tile26Icon").src = "images/tiles/" + tile26 + ".svg";

      function updateNotifications(){
        document.getElementById("tile18Count").innerHTML = [IS2Notifications notificationCountForApplication:getBundleId(tile18)];
        document.getElementById("tile19Count").innerHTML = [IS2Notifications notificationCountForApplication:getBundleId(tile19)];
        document.getElementById("tile20Count").innerHTML = [IS2Notifications notificationCountForApplication:getBundleId(tile20)];
        document.getElementById("tile22Count").innerHTML = [IS2Notifications notificationCountForApplication:getBundleId(tile22)];
        document.getElementById("tile23Count").innerHTML = [IS2Notifications notificationCountForApplication:getBundleId(tile23)];
        document.getElementById("tile25Count").innerHTML = [IS2Notifications notificationCountForApplication:getBundleId(tile25)];
        document.getElementById("tile26Count").innerHTML = [IS2Notifications notificationCountForApplication:getBundleId(tile26)];
      }

      var ampm;

      // gets date info
      var now = new Date();
      var today = now.toDateString();
      var time = now.toLocaleTimeString();
      var hours = now.getHours();
      var minutes = now.getMinutes();
      var seconds = now.getSeconds();
      var milliseconds = now.getMilliseconds();
      var newSeconds = seconds+ (milliseconds/1000);

      function convertHours(h){
      	if(twentyfourhour){
      		return h;
      	}else{
      		return ((h + 11) % 12 + 1);
      	}
      }

      function hideAllAvailableEvents() {
        for (i = 0; i < 5; i++) {
          document.getElementById(elementIdForNumber(i) + 'Title').innerHTML = "";
          document.getElementById(elementIdForNumber(i) + 'Colour').style.backgroundColor = "transparent";
          document.getElementById(elementIdForNumber(i) + 'Time').innerHTML = "";
        }
      }

      function elementIdForNumber(x) {
        switch (x) {
          case 0:
            return "eventOne";
          case 1:
            return "eventTwo";
          case 2:
            return "eventThree";
          case 3:
            return "eventFour";
          case 4:
            return "eventFive";
          default:
            return "";
        }
      }

      function timeValueCorrection(value) {
         if (value < 10) {
              return "0" + value;
         } else {
              return value;
         }
      }

      function timeToDayName(time) {
          var dayNumber = time.getDay();
          var today = new Date();
          var tomorrow = new Date(today.getTime() + (24 * 60 * 60 * 1000));

          if (dayNumber == today.getDay()) {
                return "Today";
          } else if (dayNumber == tomorrow.getDay()) {
                return "Tomorrow";
          }

          switch(dayNumber) {
              case 0:
                return "Sunday";
              case 1:
                return "Monday";
              case 2:
                return "Tuesday";
              case 3:
                return "Wednesday";
              case 4:
                return "Thursday";
              case 5:
                return "Friday";
              case 6:
                return "Saturday";
              default:
                return "";
            }
      }
        function timerFiredEventDidEnd() {
          updateCalendarData();

          // The above will also handle resetting the timer for an event's end.
      }

      function formatHours(hours) {
        if(hours >= 12){
        ampm = "p";
        }else{
        ampm = "a";
          }
        hours = (hours + 11) % 12 + 1;
        return hours;
          // The above will also handle resetting the timer for an event's end.
      }

      function updateCalendarData() {
        // First, grab the data between right now and in 7 days' time.
        var timeNow = new Date();
        var timeInWeek = timeNow.getTime() + (7 * 24 * 60 * 60 * 1000);

        var firstEndTime = 0;

      var eventsArray = JSON.parse("" + [IS2Calendar calendarEntriesJSONBetweenStartTimeAsTimestamp:timeNow.getTime() andEndTimeAsTimestamp:timeInWeek]);

        if (eventsArray.length > 0) {
              document.getElementById('noevents').style.display = "none";
              document.getElementById('eventscontainer').style.display = "inline";

              // Initially, hide all the available events we can show.
              hideAllAvailableEvents();

              // Go over events available.
              for (i = 0; i < eventsArray.length; i++) {
                var event = eventsArray[i];

                // Update title
                document.getElementById(elementIdForNumber(i) + 'Title').innerHTML = event.title;

                // Also, update the colour to display.
                document.getElementById(elementIdForNumber(i) + 'Colour').style.backgroundColor = event.associatedCalendarHexColor;

                if (event.allDay == 0) {
                    // Work out date display.
                    var timeStart = new Date(event.startTimeTimestamp);
                    var timeEnd = new Date(event.endTimeTimestamp);

                    if (timeStart.getDay() == timeEnd.getDay()) {
                        // Event is all on the same day, huzzah.
                        var timeString = "" + timeToDayName(timeStart) + ": " + formatHours(timeStart.getHours()) + ":" + timeValueCorrection(timeStart.getMinutes()) + ampm;
                        timeString += " to " + formatHours(timeEnd.getHours()) + ":" + timeValueCorrection(timeEnd.getMinutes()) + ampm;

                        document.getElementById(elementIdForNumber(i) + 'Time').innerHTML = timeString;
                    } else {
                          // Event goes over multiple days...
                          var timeString = "" + timeToDayName(timeStart) + ", " + formatHours(timeStart.getHours()) + ":" + timeValueCorrection(timeStart.getMinutes()) + ampm;
                          timeString += " to " + timeToDayName(timeEnd) + ", " + formatHours(timeEnd.getHours()) + ":" + timeValueCorrection(timeEnd.getMinutes()) + ampm;
                          document.getElementById(elementIdForNumber(i) + 'Time').innerHTML = timeString;
                    }
                } else {
                    var timeStart = new Date(event.startTimeTimestamp);
                    document.getElementById(elementIdForNumber(i) + 'Time').innerHTML = timeToDayName(timeStart) + ": all day";
                }

                // handle end times for timer.
                if (firstEndTime == 0 || event.endTimeTimestamp < firstEndTime) {
                  firstEndTime = event.endTimeTimestamp;
                }

                if (i == 4) {
                  // Can't display more than 5 upcoming events!
                  break;
                }
              }

         } else {
              // Just display that there's no events.
               document.getElementById('noevents').style.display = "inline";
               document.getElementById('eventscontainer').style.display = "none";
         }

          // Also, ensure we refresh when the first end time is reached of events.
          // Setting timeout is in milliseconds, and both timeNow and firstEndTime are too.

          if (firstEndTime == 0) {
            // Setup a time for the next midnight instead.
             timeNow.setDate(timeNow.getDate()+1);
             firstEndTime = timeNow.getTime();
          }

          setTimeout(timerFiredEventDidEnd, firstEndTime - timeNow);
      }


      var swipeTile18 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+getBundleId(tile18)];
          }
        }
      };
      var swipetile19 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+getBundleId(tile19)];
          }
        }
      };
      var swipetile20 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+getBundleId(tile20)];
          }
        }
      };
      var swipetile22 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+getBundleId(tile22)];
          }
        }
      };
      var swipetile23 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+getBundleId(tile23)];
          }
        }
      };
      var swipetile25 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+getBundleId(tile25)];
          }
        }
      };
      var swipetile26 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+getBundleId(tile26)];
          }
        }
      };
      var swipetile27 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+"com.apple.AppStore"];
          }
        }
      };
      var swipetile28 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+"com.saurik.Cydia"];
          }
        }
      };
      var swipetile29 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+"com.apple.mobilecal"];
          }
        }
      };
      var swipetile30 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+"com.apple.reminders"];
          }
        }
      };
      var swipetile31 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+"com.apple.mobileme.fmip1"];
          }
        }
      };
      var swipetile32 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            window.history.back()
          }
        }
      };

      //adds swipe detection to element
      detectswipe('#tile18Container', swipeTile18.itemSwipe);
      detectswipe('#tile19Container', swipetile19.itemSwipe);
      detectswipe('#tile20Container', swipetile20.itemSwipe);
      detectswipe('#tile22Container', swipetile22.itemSwipe);
      detectswipe('#tile23Container', swipetile23.itemSwipe);
      detectswipe('#tile25Container', swipetile25.itemSwipe);
      detectswipe('#tile26Container', swipetile26.itemSwipe);
      detectswipe('#tile27Container', swipetile27.itemSwipe);
      detectswipe('#tile28Container', swipetile28.itemSwipe);
      detectswipe('#tile29Container', swipetile29.itemSwipe);
      detectswipe('#tile30Container', swipetile30.itemSwipe);
      detectswipe('#tile31Container', swipetile31.itemSwipe);
      detectswipe('#tile32Container', swipetile32.itemSwipe);

      //]]>
    </script>
  </body>
</html>
