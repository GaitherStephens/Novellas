<!--Novellas by SPQRGuyMontag
Based on Metro-UI-CSS by Sergey Pimenov
Based on the work of JunesiPhone and Matchstic-->
<!DOCTYPE html>
<html>
  <head>
    <title>Novellas by SPQRGuyMontag</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <script src="js/lang.js"></script>
    <link href="css/main.css" rel="stylesheet">
    <script src="js/metro.js"></script>
    <script src="js/swipes.js"></script>
    <script src="js/main.js"></script>
    <script src="js/jquery-2.1.3.min.js"></script>

</head>
<body style="overflow-y: hidden;">
  <div id="mainElement">
    <div id="statusBar"></div>

    <div id="tile1Container">
      <img id="tile1Icon">
      <div id="tile1Count"></div>
    </div>

    <div id="tile2Container">
      <img id="tile2Icon">
      <div id="tile2Count"></div>
    </div>

    <div id="tile3Container">
      <div class='center-dial' id="center-dial">
          <div class='hand-container' id='hourHand'>
            <div class='hour-hand' id='hour-hand'></div>
          </div>
          <div class='hand-container' id='secondHand'>
            <div class='second-hand' id='second-hand'></div>
          </div>
          <div class='hand-container' id='digital'>
            <div class='digital-hour' id="digital-hour">23</div>
          </div>
          <div class='hand-container' id='digital'>
            <div class='digital-minute' id="digital-minute">58</div>
          </div>
          <div class='hand-container' id='digital'>
            <div class='digital-second' id="digital-second">59</div>
          </div>
        </div>
    </div>

    <div id="tile4Container">
      <div id="wxWrapper">

        <div id="wxIcon"><img id="wx_icon" src="images/wx/32.png"></div>
        <div id="wxTemp"></div>
        <div id="wxCity">Loading...</div>
        <div id="wxCondition"></div>
        <div id="wxWindDirection"></div>
        <div id="wxWindSpeed"></div>
        <section id="daySection">

          <!-- display next three days -->
          <div id="dayZero" style="margin-top:0;">
            <center>
            <p id="dayZeroDayString"></p>
            <img id="dayZeroImg" src="images/wx/32.png"/>
            <p style="width: 50px; text-align:center;"><span id="dayZeroHigh"></span>&nbsp;<span id="dayZeroLow" style="color:#bfbfbf;"></span></p>
            </center>
          </div>
          <div id="dayOne" style="margin-top:0;">
            <center>
            <p id="dayOneDayString"></p>
            <img id="dayOneImg"/>
            <p style="width: 50px; text-align:center;"><span id="dayOneHigh"></span>&nbsp;<span id="dayOneLow" style="color:#bfbfbf;"></span></p>
            </center>
          </div>

    			<div id="dayTwo" style="margin-top:0;">
    				<center>
    				<p id="dayTwoDayString"></p>
    				<img id="dayTwoImg"/>
            <p style="width: 50px; text-align:center;"><span id="dayTwoHigh"></span>&nbsp;<span id="dayTwoLow" style="color:#bfbfbf;"></span></p>
    				</center>
    			</div>
        </section>
      </div>
        <div id="wxBgDiv"></div>
    </div>

  <div id="tile5Container">
    <img id="tile5Icon">
    <div id="tile5Count"></div>
  </div>

  <div id="tile6Container">
    <img id="tile6Icon">
    <div id="tile6Count"></div>
  </div>

  <div id="tile7Container">
    <img id="tile7Icon">
    <div id="tile7Count"></div>
  </div>

  <div id="tile8Container">
    <div id="artist"></div>
    <div id="title"></div>
    <div id="album"></div>
      <img id="tile8Icon" src="images/tiles/music.svg">
    <div id="previousTrackDiv"><img id="previousTrack" src="images/music/previousTrack.svg"></div>
    <div id="nextTrackDiv"><img id="nextTrack" src="images/music/nextTrack.svg"></div>
    <div id="playPauseTrackDiv">
      <img id="playTrack" src="images/music/playTrack.svg">
      <img id="pauseTrack" src="images/music/pauseTrack.svg">
    </div>
        <div id="musicBgDiv"></div>
    </div>

    <div id="tile9Container">
      <img id="tile9Icon">
      <div id="tile9Count"></div>
    </div>

    <div id="tile10Container">
      <img id="tile10Icon" src="images/tiles/apps.svg">
      <div id="tile10Count"></div>
    </div>

    <div id="tile11Container">
      <img id="tile11Icon">
      <div id="tile11Count"></div>
    </div>

    <div id="tile12Container">
      <img id="tile12Icon" src="images/tiles/camera.svg">
    </div>

    <div id="tile13Container">
      <img id="tile13Icon" src="images/tiles/maps.svg">
    </div>

    <div id="tile14Container">
      <img id="tile14Icon" src="images/tiles/siri.svg">
    </div>

    <div id="tile15Container">
      <img id="tile15Icon" src="images/tiles/lock.svg">
    </div>

    <div id="tile16Container">
      <img id="tile16Icon" src="images/tiles/settings.svg">
    </div>

    <div id="tile17Container">
      <img id="tile17Icon" src="images/tiles/chevron-right.svg">
    </div>

  </div>

    <script type="text/cycript">
      //<![CDATA[
      var widgetIdentifier = "com.gaitherstephens.novellas";
      var tile1 = tile1Op;
      var tile2 = tile2Op;
      var tile5 = tile5Op;
      var tile6 = tile6Op;
      var tile7 = tile7Op;
      var tile9 = tile9Op;
      var tile11 = tile11Op;
      var twentyfourhour = twentyfourhourOp;
      var wxRefresh = wxRefreshOp;
      var wxBg = wxBgOp;
      var favMusicApp = favMusicAppOp;
      var favMapApp = favMapAppOp;
      var bgColor = bgColorOp;
      var bgOpacity = bgOpacityOp;
      var tilesOpacity = tilesOpacityOp;
      var firstTimeMusic = true;
      var tilesColor = tilesColorOp;
      // Setup of widget
      window.onload = function() {
        [IS2Weather registerForWeatherUpdatesWithIdentifier:widgetIdentifier andCallback:^ void () {
          updateWx();
        }];

        [IS2Weather setWeatherUpdateTimeInterval:wxRefresh forRequester:widgetIdentifier];

        //registers widget for media updates
        [IS2Media registerForNowPlayingNotificationsWithIdentifier:widgetIdentifier andCallback:^ void () {
            updateMedia();
        }];

        [IS2Notifications registerForBulletinNotificationsWithIdentifier:widgetIdentifier andCallback:^ void () {
            updateNotifications();
        }];
        updateNotifications();
      }

      // Make sure to de-register ourselves when removed from the user's screen.
      window.onunload = function() {
        [IS2Media unregisterForNotificationsWithIdentifier:widgetIdentifier];
        [IS2Weather unregisterForUpdatesWithIdentifier:widgetIdentifier];
        [IS2Weather removeRequesterForWeatherTimeInterval:widgetIdentifier];
        [IS2Notifications unregisterForNotificationsWithIdentifier:widgetIdentifier];
        return null;
      };

        document.getElementById("mainElement").style.backgroundColor = "rgba("+bgColor+bgOpacity+")";


      if(tilesColor === "multicolor"){
        document.getElementById("tile1Container").style.backgroundColor = getAppColor(tile1)+tilesOpacity+")";
        document.getElementById("tile2Container").style.backgroundColor = getAppColor(tile2)+tilesOpacity+")";
        document.getElementById("tile3Container").style.backgroundColor = "rgba(102,102,102,"+tilesOpacity+")";
        document.getElementById("tile4Container").style.backgroundColor = "rgba(255,255,255,"+tilesOpacity+")";
        document.getElementById("tile5Container").style.backgroundColor = getAppColor(tile5)+tilesOpacity+")";
        document.getElementById("tile6Container").style.backgroundColor = getAppColor(tile6)+tilesOpacity+")";
        document.getElementById("tile7Container").style.backgroundColor = getAppColor(tile7)+tilesOpacity+")";
        document.getElementById("tile8Container").style.backgroundColor = "rgba(173,16,60,"+tilesOpacity+")";
        document.getElementById("tile9Container").style.backgroundColor = getAppColor(tile9)+tilesOpacity+")";
        document.getElementById("tile10Container").style.backgroundColor = "rgba(255,118,188,"+tilesOpacity+")";
        document.getElementById("tile11Container").style.backgroundColor = getAppColor(tile11)+tilesOpacity+")";
        document.getElementById("tile12Container").style.backgroundColor = "rgba(254,124,34,"+tilesOpacity+")";
        document.getElementById("tile13Container").style.backgroundColor = "rgba(0,193,63,"+tilesOpacity+")";
        document.getElementById("tile14Container").style.backgroundColor = "rgba(255,29,119,"+tilesOpacity+")";
        document.getElementById("tile15Container").style.backgroundColor = "rgba(225,183,0,"+tilesOpacity+")";
        document.getElementById("tile16Container").style.backgroundColor = "rgba(0,130,135,"+tilesOpacity+")";
        document.getElementById("tile17Container").style.backgroundColor = "rgba(99,47,0,"+tilesOpacity+")";
      }else{
        for(i = 1; i < 18; i++){
          document.getElementById("tile"+i+"Container").style.backgroundColor = "rgba("+tilesColor+tilesOpacity+")";
        }
      }

      document.getElementById("tile1Icon").src = "images/tiles/" + tile1 + ".svg";
      document.getElementById("tile2Icon").src = "images/tiles/" + tile2 + ".svg";
      document.getElementById("tile5Icon").src = "images/tiles/" + tile5 + ".svg";
      document.getElementById("tile6Icon").src = "images/tiles/" + tile6 + ".svg";
      document.getElementById("tile7Icon").src = "images/tiles/" + tile7 + ".svg";
      document.getElementById("tile9Icon").src = "images/tiles/" + tile9 + ".svg";
      document.getElementById("tile11Icon").src = "images/tiles/" + tile11 + ".svg";

      function updateMedia(){
        if(firstTimeMusic){
          firstTimeMusic = false;
          $('#tile8Icon').remove();
          document.getElementById("artist").innerHTML = [IS2Media currentTrackArtist];
          document.getElementById("title").innerHTML = [IS2Media currentTrackTitle];
          document.getElementById("album").innerHTML = [IS2Media currentTrackAlbum];
          document.getElementById("previousTrack").style.opacity = 1;
          document.getElementById("playTrack").style.opacity = 1;
          document.getElementById("pauseTrack").style.opacity = 1;
          document.getElementById("nextTrack").style.opacity = 1;
          document.getElementById("musicBgDiv").style.backgroundImage = "url(" + [IS2Media currentTrackArtworkBase64] + ")";
          document.getElementById("musicBgDiv").style.opacity = .6;
        }else{
          document.getElementById("musicBgDiv").style.backgroundImage = "url(" + [IS2Media currentTrackArtworkBase64] + ")";
          document.getElementById("musicBgDiv").style.opacity = .6;
          document.getElementById("artist").innerHTML = [IS2Media currentTrackArtist];
      		document.getElementById("title").innerHTML = [IS2Media currentTrackTitle];
      		document.getElementById("album").innerHTML = [IS2Media currentTrackAlbum];
        }
        document.getElementById("musicBgDiv").style.backgroundImage = "url(" + [IS2Media currentTrackArtworkBase64] + ")";
        document.getElementById("musicBgDiv").style.opacity = .6;
        document.getElementById("artist").innerHTML = [IS2Media currentTrackArtist];
        document.getElementById("title").innerHTML = [IS2Media currentTrackTitle];
        document.getElementById("album").innerHTML = [IS2Media currentTrackAlbum];
      }

      function updateWx(){
        var dayArray = JSON.parse("" + [IS2Weather dayForecastsForCurrentLocationJSON]);
        var flickrCount = Math.floor((Math.random() * 99) + 1);
        var flickrSort = "relevance";
        var url;
        var date = new Date();
  			var hours = date.getHours();

        //used to determine day or night
        var dayNight = "Day";
        if(hours > 0 && hours < 5){
          dayNight = "Night"
        }else if(hours > 5 && hours < 8){
          dayNight = "Early Morning";
        }else if(hours >= 8 && hours < 10){
          dayNight = "Morning";
        }else if(hours >= 10 && hours < 17){
          dayNight = "";
        }else if(hours >= 17 && hours < 20){
          dayNight = "Evening";
        }else if(hours >= 20 && hours <= 23){
          dayNight = "Night";
        }

        //custom language for better Flickr results
        function wxConScrub(c){
          if(c.includes("Tornado")){c = "Tornado Weather"; flickrSort = "interestingness_desc";}
          if(c.includes("Sleet")){c = "Sleet"; flickrSort = "relevance";}
          if(c.includes("Rain") || c.includes("Showers")){c = "Rain"; flickrSort = "relevance";}
          if(c.includes("Snow")){c = "Snow Falling"; flickrSort = "relevance";}
          if(c.includes("Sunny")){c = "Sunny Sky"; flickrSort = "relevance";}
          if(c.includes("Hail")){c = "Hailstorm"; flickrSort = "relevance";}
          if(c.includes("Tropical") || c.includes("Hurricane")){c = "Tropical Storm Weather"; flickrSort = "relevance";}
          if(c.includes("ThunderStorms") || c.includes("Thundershowers")){c = "Thunderstorm Weather Sky"; flickrSort = "interestingness_desc";}
          if(c.includes("Dust")){c = "Dust Weather Sky"; flickrSort = "relevance";}
          if(c.includes("Drizzle")){c = "Freezing Rain"; flickrSort = "interestingness_desc";}
          if(c.includes("Cold")){c = "Freezing Weather"; flickrSort = "interestingness_desc";}
          if(c.includes("Cloudy")){c = "Cloudy Weather Sky"; flickrSort = "relevance";}
          if(c.includes("Foggy")){c = "Foggy Weather Sky"; flickrSort = "relevance";}
          if(c.includes("Haze")){c = "Hazy Weather Sky"; flickrSort = "relevance";}
          if(c.includes("Smoky")){c = "Hazy Weather Sky"; flickrSort = "relevance";}
          if(c.includes("Blustery") || c.includes("Windy")){c = "Wind Field"; flickrSort = "interestingness_desc";}
          if(c.includes("Fair") || c.includes("Clear")){c = "Cloudless Sky"; flickrSort = "relevance";}
          if(c.includes("Hot")){c = "Palm Trees"; flickrSort = "relevance";}
          return c;
        }

        document.getElementById("wxIcon").src = "images/wx/" + [IS2Weather currentCondition] + ".png";
        document.getElementById("wxTemp").innerHTML = [IS2Weather currentTemperature] + "&deg";
        document.getElementById("wxCity").innerHTML = [IS2Weather currentLocation];
        document.getElementById("wxCondition").innerHTML = [IS2Weather currentConditionAsString];
        document.getElementById("wxWindDirection").innerHTML = " Wind Direction: " + degToCard([IS2Weather currentWindDirection]);
        document.getElementById("wxWindSpeed").innerHTML = " Wind Speed: " + [IS2Weather currentWindSpeed];

        //populates forecast elements
        document.getElementById('dayZeroDayString').innerHTML = translate[current].sday[dayArray[1].dayOfWeek - 1];
        document.getElementById('dayZeroImg').src = "images/wx/" + dayArray[1].condition + ".png";
        document.getElementById('dayZeroHigh').innerHTML = "" + dayArray[1].high + "&deg";
        document.getElementById('dayZeroLow').innerHTML = "" + dayArray[1].low + "&deg";

        document.getElementById('dayOneDayString').innerHTML = translate[current].sday[dayArray[2].dayOfWeek - 1];
        document.getElementById('dayOneImg').src = "images/wx/" + dayArray[2].condition + ".png";
        document.getElementById('dayOneHigh').innerHTML = "" + dayArray[2].high + "&deg";
        document.getElementById('dayOneLow').innerHTML = "" + dayArray[2].low + "&deg";

        document.getElementById('dayTwoDayString').innerHTML = translate[current].sday[dayArray[3].dayOfWeek - 1];
        document.getElementById('dayTwoImg').src = "images/wx/" + dayArray[3].condition + ".png";
        document.getElementById('dayTwoHigh').innerHTML = "" + dayArray[3].high + "&deg";
        document.getElementById('dayTwoLow').innerHTML = "" + dayArray[3].low + "&deg";

        //shows either flickr images or stock images
          if(wxBg === "flickr"){
            //gets flickr images
            $(function (){
              $.ajax({
                url: "https://api.flickr.com/services/rest/",
                data: {
                  method: "flickr.photos.search",
                  api_key: "c1955bceeed9a3a76af982daf012c546",
                  text: "" + wxConScrub([IS2Weather currentConditionAsString]) + " " + dayNight,
                  sort: flickrSort,
                  content_type: 1,
                  safe_search: 2,
                  media: "photos",
                  format: "json",
                  per_page: 100,
                  nojsoncallback: 1
                },
                success: function (response) {
                  $.each(response.photos.photo, function (index, value) {
                    url = 'https://farm' + value.farm + '.staticflickr.com/' + value.server + '/' + value.id + '_' + value.secret + '.jpg';

                    if(flickrCount === index || index === response.photos.photo.length){
                      //fades out old weather picture
                      document.getElementById("wxBgDiv").style.backgroundImage = "url(" + url + ")";
                      document.getElementById("wxBgDiv").style.opacity = .6;
                      return false;
                    }
                  });
                }
              });
            })
          }else if(wxBg === "stock"){
              document.getElementById("wxBgDiv").style.backgroundImage = "url(images/wx/weather" + [IS2Weather currentCondition] + ".jpg)";
              document.getElementById("wxBgDiv").style.opacity = .6;
          }
      }

      function updateNotifications(){
        document.getElementById("tile1Count").innerHTML = [IS2Notifications notificationCountForApplication:getBundleId(tile1)];
        document.getElementById("tile2Count").innerHTML = [IS2Notifications notificationCountForApplication:getBundleId(tile2)];
        document.getElementById("tile5Count").innerHTML = [IS2Notifications notificationCountForApplication:getBundleId(tile5)];
        document.getElementById("tile6Count").innerHTML = [IS2Notifications notificationCountForApplication:getBundleId(tile6)];
        document.getElementById("tile7Count").innerHTML = [IS2Notifications notificationCountForApplication:getBundleId(tile7)];
        document.getElementById("tile9Count").innerHTML = [IS2Notifications notificationCountForApplication:getBundleId(tile9)];
        document.getElementById("tile11Count").innerHTML = [IS2Notifications notificationCountForApplication:getBundleId(tile11)];
      }

      var swipeTile1 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+getBundleId(tile1)];
          }
        }
      };
      var swipeTile2 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+getBundleId(tile2)];
          }
        }
      };
      var swipeTile3 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+"com.apple.mobiletimer"];
          }
        }
      };
      var swipeTile4 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            updateWx();
          }
        }
      };
      var swipeTile5 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+getBundleId(tile5)];
          }
        }
      };
      var swipeTile6 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+getBundleId(tile6)];
          }
        }
      };
      var swipeTile7 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+getBundleId(tile7)];
          }
        }
      };

      var swipePreviousTrack = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2Media skipToPreviousTrack];
          }
        }
      };
      var swipeNextTrack = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2Media skipToNextTrack];
          }
        }
      };
      var swipePlayPauseTrack = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            if(firstTimeMusic){
              [IS2System openApplication:@""+getBundleId(favMusicApp)];
            }else{
              [IS2Media togglePlayPause];
            }
          }
        }
      };
      var swipeTile9 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+getBundleId(tile9)];
          }
        }
      };
      var swipeTile10 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [[SBUIController sharedInstance] openAppDrawer];
          }
        }
      };
      var swipeTile11 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+getBundleId(tile11)];
          }
        }
      };
      var swipeTile12 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+"com.apple.camera"];
          }
        }
      };
      var swipeTile13 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+getBundleId(favMapApp)];
          }
        }
      };
      var swipeTile14 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openSiri];
          }
        }
      };
      var swipeTile15 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System lockDevice];
          }
        }
      };
      var swipeTile16 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            [IS2System openApplication:@""+"com.apple.Preferences"];
          }
        }
      };
      var swipeTile17 = {
        itemSwipe: function(direction){
          if(direction === 'p'){
            window.open("page2.html", "_self");
          }
        }
      };

      //adds swipe detection to element
      detectswipe('#tile1Container', swipeTile1.itemSwipe);
      detectswipe('#tile2Container', swipeTile2.itemSwipe);
      detectswipe('#tile3Container', swipeTile3.itemSwipe);
      detectswipe('#tile4Container', swipeTile4.itemSwipe);
      detectswipe('#tile5Container', swipeTile5.itemSwipe);
      detectswipe('#tile6Container', swipeTile6.itemSwipe);
      detectswipe('#tile7Container', swipeTile7.itemSwipe);
      detectswipe('#previousTrackDiv', swipePreviousTrack.itemSwipe);
      detectswipe('#playPauseTrackDiv', swipePlayPauseTrack.itemSwipe);
      detectswipe('#nextTrackDiv', swipeNextTrack.itemSwipe);
      detectswipe('#tile9Container', swipeTile9.itemSwipe);
      detectswipe('#tile10Container', swipeTile10.itemSwipe);
      detectswipe('#tile11Container', swipeTile11.itemSwipe);
      detectswipe('#tile12Container', swipeTile12.itemSwipe);
      detectswipe('#tile13Container', swipeTile13.itemSwipe);
      detectswipe('#tile14Container', swipeTile14.itemSwipe);
      detectswipe('#tile15Container', swipeTile15.itemSwipe);
      detectswipe('#tile16Container', swipeTile16.itemSwipe);
      detectswipe('#tile17Container', swipeTile17.itemSwipe);

      //]]>
    </script>
    <script src='js/jquery-3.1.1.min.js'></script>
    <script type="text/javascript">
      var j3 = $.noConflict(true);
    </script>
    <script src="js/clock.js"></script>
  </body>
</html>
